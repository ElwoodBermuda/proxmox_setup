---


- name: Update and upgrade apt packages
  become: true 
  apt:
    upgrade: yes
    update_cache: yes

- name: install microk8s
  become: true
  snap:
    name: microk8s  
    classis: yes
    channel: 1.32





- name: add root to microk8s group
  become: true
  cmd: |
    sudo usermod -a -G microk8s $USER
    mkdir -p ~/.kube 
    chmod 0700 ~/.kube


- name: enable ingress
  become: true
  shell:
    cmd: microk8s enable ingress


- name: enable dashboard
  become: true
  shell:
    cmd: microk8s enable dashboard




- name: enable hostpath storage
  become: true
  shell:
    cmd: microk8s enable hostpath-storage
